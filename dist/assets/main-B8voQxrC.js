import"./boostrap-7eaMPqHh.js";const R=(o,e)=>o/e,j=(o,e)=>o/e*100+"%",T=(o,e)=>o-e,w=(o,e)=>o/e;document.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("calcular-productividad"),e=document.querySelector("calc-eficiencia").shadowRoot,t=e.getElementById("myModal"),n=e.getElementById("closeModalBtn"),s=e.getElementById("calcForm"),a=e.getElementById("form-container"),r=e.getElementById("resultado-container"),c=e.getElementById("resultado");o.addEventListener("click",()=>{t.style.display="flex"}),n.addEventListener("click",()=>{t.style.display="none",s.reset(),a.style.display="block",r.style.display="none"}),s.addEventListener("submit",d=>{d.preventDefault();const m=e.getElementById("total").value;e.getElementById("horas").value;const y=e.getElementById("costos").value,l=e.getElementById("defectos").value,i=T(m,l),u=w(i,y),f=j(l,m);console.log(f),a.style.display="none",r.style.display="flex",c.textContent=u.toFixed(2)})});const A="https://664a2109a300e8795d41126f.mockapi.io/api/1/costosindirectos",S=(o,e)=>o/e;async function x(){try{const o=await fetch(A,{method:"GET"});if(!o.ok)throw new Error("Error al obtener los datos de la API");const e=await o.json();let t=0;for(const n of e){const s=parseFloat(n.valor);t+=isNaN(s)?0:s}return console.log("La suma de todos los valores es:",t),t}catch(o){throw console.error("Error:",o),o}}const N=(o,e)=>o*e,H=(o,e,t)=>o*e*t,q=(o,e,t)=>o+e+t,V=(o,e)=>o*e,z=o=>o.toLocaleString("es-CO",{style:"currency",currency:"COP"}).replace(/COP\s/,""),C=(o,e,t)=>{fetch(o,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(n=>{if(n.ok)return n.json()}).catch(n=>{console.log("No se pudo enviar los datos")}),t.reset()};let E,v,h;const J="https://665630689f970b3b36c49525.mockapi.io/manoDeObra";document.addEventListener("DOMContentLoaded",()=>{const o=document.querySelector("calc-eficiencia").shadowRoot;o.getElementById("calcForm").addEventListener("submit",()=>{E=o.getElementById("total").value,v=o.getElementById("costos").value,h=o.getElementById("defectos").value});const t=document.getElementById("calcularManoDeObra"),n=document.querySelector("calc-obra").shadowRoot,s=n.getElementById("myModal"),a=n.getElementById("closeModalBtn"),r=n.getElementById("calcForm"),c=n.getElementById("form-container"),d=n.getElementById("resultado-container"),m=n.getElementById("resultado");t.addEventListener("click",()=>{s.style.display="flex"}),a.addEventListener("click",()=>{s.style.display="none",r.reset(),c.style.display="block",d.style.display="none"}),r.addEventListener("submit",y=>{y.preventDefault();const l=n.getElementById("totalEmpleados").value,i=n.getElementById("salarioBase").value,u=n.getElementById("horasTrabajadas").value,f=n.getElementById("beneficios").value,b=T(E,h),O=w(b,v),U=R(v,E),I=S(i,u),B=H(I,u,l),D=N(f,l);x().then(p=>{console.log(p);const $=j(h,E),P=q(B,D,p),F=V(u,l);c.style.display="none",d.style.display="flex",m.textContent=z(P),fetch(J,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({empleados:l,productividadEfectiva:b,costosOperativosUnd:U,tasaDeDefectos:$,eficienciaOperativa:O,salarioPorHora:I,horasTrabajadas:F,costosIndirectosTotales:p,beneficiosTotales:D,salarioTotal:B,manoDeObraTotal:P})}).then(g=>{if(g.ok)return g.json()}).catch(g=>{console.log("No se pudo enviar los datos")})}).catch(p=>{console.error("Error al calcular costos indirectos totales:",p)})})});const G="https://665630689f970b3b36c49525.mockapi.io/materiaPrima",k=document.getElementById("mpForm");k.addEventListener("submit",o=>{o.preventDefault();let e={idMateriaPrima:document.getElementById("idMp").value,nombre:document.getElementById("nombre").value,fechaDeAdquisicion:document.getElementById("fechaAdqui").value,fechaDeVencimiento:document.getElementById("fechaVenci").value,costoUnidad:document.getElementById("costoUnidad").value,proveedor:document.getElementById("proveedor").value,descripcion:document.getElementById("descripcion").value,unidadMedida:document.getElementById("unidadMedida").value,cantidad:document.getElementById("cantidad").value,categoria:document.getElementById("categoria").value,ubicacion:document.getElementById("ubicacion").value};C(G,e,k)});const K=document.getElementById("inventario"),Q=document.getElementById("inventoryDiv"),W=document.getElementById("prodDiv"),X=document.getElementById("prodDiv"),Y=document.getElementById("mpForm");K.addEventListener("click",()=>{Q.style.display="none",W.style.display="none",X.style.display="none",Y.style.display="flex"});const Z=document.getElementById("produccion"),_=document.getElementById("inventoryDiv"),ee=document.getElementById("prodDiv"),oe=document.getElementById("prodDiv"),te=document.getElementById("productForm");Z.addEventListener("click",()=>{_.style.display="none",ee.style.display="none",oe.style.display="none",te.style.display="flex"});const ae=document.getElementById("Costos-indirectos"),ne=document.getElementById("inventoryDiv"),se=document.getElementById("prodDiv"),re=document.getElementById("prodDiv"),ce=document.getElementById("costoForm");ae.addEventListener("click",()=>{ne.style.display="none",se.style.display="none",re.style.display="none",ce.style.display="flex"});const M=[{nombre:"Camisa manga Larga",hilos:50,botones:6,telas:3,id:"1",horas:4,trabajadores:4},{nombre:"Camisa manga Corta",hilos:45,botones:6,telas:2,id:"2",horas:3,trabajadores:4},{nombre:"Vestido Largo",hilos:20,botones:1,telas:5,sierres:1,lentejuelas:100,cauchos:2,encajes:12,"costo-unidad":0,id:"6",horas:1,trabajadores:4},{nombre:"Vestido Corto",hilos:15,botones:1,telas:4,sierres:1,lentejuelas:50,cauchos:2,encajes:8,"costo-unidad":0,id:"4",horas:5,trabajadores:4},{nombre:"Pantalon de Vestir",hilos:20,botones:3,telas:3,sierres:1,cauchos:1,"costo-unidad":0,id:"5",horas:4,trabajadores:4},{nombre:"Pantalon de Jean",hilos:20,botones:1,telas:3,sierres:1,"costo-unidad":0,id:"6",horas:3,trabajadores:4},{nombre:"Short",hilos:12,botones:2,telas:2,sierres:1,id:"7",horas:2,trabajadores:4}];function le(o){return fetch("https://665630689f970b3b36c49525.mockapi.io/materiaPrima").then(e=>{if(e.ok)return e.json();throw new Error("Error al obtener los datos de materia prima de la API")}).then(e=>{let t={...o},n=null;e.forEach(a=>{for(const r in t)if(r!=="horas"&&r!=="trabajadores"&&a.categoria.toLowerCase()===r&&t[r]>0){const c=Math.min(t[r],parseInt(a.cantidad));a.cantidad-=c,t[r]-=c,t[r]===0&&delete t[r];break}});for(const a in t){n=a;break}if(n)return alert(`No hay suficiente stock de ${n} para la producción.`),Promise.reject(new Error(`Stock insuficiente de ${n}`));const s=e.map(a=>{const r=JSON.stringify(a);return console.log("Datos a enviar en PUT:",r),fetch(`https://665630689f970b3b36c49525.mockapi.io/materiaPrima/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:r}).then(c=>{if(c.ok)console.log(`Datos de materia prima con id ${a.id} actualizados correctamente`);else return c.json().then(d=>{throw console.error(`Error al actualizar los datos de materia prima con id ${a.id}:`,d),new Error(`Error al actualizar los datos de materia prima con id ${a.id}`)})}).catch(c=>{throw console.error("Ocurrió un error:",c),c})});return Promise.all(s)}).catch(e=>(console.error("Ocurrió un error:",e),Promise.reject(e)))}const de=(o,e,t)=>{const n=M.find(a=>a.nombre===o);if(!n)return console.error(`No se encontró la prenda para el producto ${o}`),0;let s=0;return Object.keys(n).forEach(a=>{a!=="nombre"&&a!=="id"&&a!=="horas"&&a!=="trabajadores"&&a!=="costo-unidad"&&(t[a]?s+=n[a]*e*t[a]:console.error(`No se encontró costo por unidad para ${a}`))}),s},ie=(o,e)=>o*e,ue=(o,e)=>o/e+"%",me=(o,e)=>o*e,ye="https://66586d8e5c36170526486c75.mockapi.io/lotes",pe="https://665630689f970b3b36c49525.mockapi.io/manoDeObra",Ee="https://665630689f970b3b36c49525.mockapi.io/materiaPrima",L=document.getElementById("productForm");L.addEventListener("submit",async o=>{o.preventDefault();const e=document.getElementById("producto").value,t=parseInt(document.getElementById("cantidadproductos").value),n=document.getElementById("productosmes").value,s=parseInt(document.getElementById("lotesmes").value);try{let a=ge(e,t);console.log("Horas Trabajadas:",a);const r=me(t,s),c=await fetch(pe);if(!c.ok)throw new Error("Error al obtener el salario de la API");const d=await c.json(),m=d[d.length-1].salarioPorHora,y=ue(r,s),l=await fe();console.log(l);const i=de(e,t,l);console.log("Gastos Materiales Lote:",i);const u=ie(a,m);await le(i),C(ye,{producto:e,cantidad:t,baseasignacion:n,horastrabajadas:a,costoMOlote:u,costoMPlote:i,costosidirectoslote:r,tasaasignacionCI:y},L)}catch(a){console.error("Error:",a)}});async function fe(){try{const o=await fetch(Ee);if(!o.ok)throw new Error("Error al obtener los costos de la API");const e=await o.json();console.log("Datos de la API de costos:",e);let t={};return e.forEach(n=>{const s=n.categoria.toLowerCase(),a=typeof n.costoUnidad=="string"?parseFloat(n.costoUnidad):n.costoUnidad;t[s]?t[s]+=a:t[s]=a}),console.log("Costos por categoría:",t),t}catch(o){throw console.error("Error al obtener los costos de la API:",o),o}}function ge(o,e){const t=M.find(n=>n.nombre===o);return console.log("Prenda:",t),t&&t.horas?t.horas*e:0}document.getElementById("cantidadproductos");
